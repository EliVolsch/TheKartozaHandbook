<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="Kartoza" name="author"/>
<link href="../../../img/favicon.ico" rel="shortcut icon"/>
<title>Kubectl - Kartoza Handbook</title>
<link href="../../../css/bootstrap.min.css" rel="stylesheet"/>
<link href="../../../css/font-awesome.min.css" rel="stylesheet"/>
<link href="../../../css/base.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" rel="stylesheet"/>
<script defer="" src="../../../js/jquery-1.10.2.min.js"></script>
<script defer="" src="../../../js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<link href="../../../../pdfs/TheKartozaHandbook.pdf" rel="alternate" title="PDF" type="application/pdf"/></head>
<body>
<div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
<div class="container">
<a class="navbar-brand" href="../../..">Kartoza Handbook</a>
<!-- Expander button -->
<button class="navbar-toggler" data-target="#navbar-collapse" data-toggle="collapse" type="button">
<span class="navbar-toggler-icon"></span>
</button>
<!-- Expanded navigation -->
<div class="navbar-collapse collapse" id="navbar-collapse">
<!-- Main navigation -->
<ul class="nav navbar-nav">
<li class="dropdown">
<a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Home <b class="caret"></b></a>
<ul class="dropdown-menu">
<li>
<a class="dropdown-item" href="../../..">Home</a>
</li>
<li>
<a class="dropdown-item" href="../../../about_kartoza.md">About Kartoza</a>
</li>
<li>
<a class="dropdown-item" href="../../../contributing/">Contributing</a>
</li>
<li>
<a class="dropdown-item" href="../../../polyglot/">Polyglot</a>
</li>
</ul>
</li>
<li class="dropdown">
<a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Company <b class="caret"></b></a>
<ul class="dropdown-menu">
<li>
<a class="dropdown-item" href="../../../company/kartoza/">Kartoza</a>
</li>
<li>
<a class="dropdown-item" href="../../../company/kartoza/strategic_objective/">Strategic Objective</a>
</li>
<li>
<a class="dropdown-item" href="../../../company/kartoza/operating_principles/">Operating Principles</a>
</li>
<li>
<a class="dropdown-item" href="../../../company/kartoza/setting_up_your_computer/">Staff Computers</a>
</li>
</ul>
</li>
<li class="dropdown">
<a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">GIS <b class="caret"></b></a>
<ul class="dropdown-menu">
<li>
<a class="dropdown-item" href="../../../gis/">GIS</a>
</li>
<li>
<a class="dropdown-item" href="../../../gis/cartography/">Cartography</a>
</li>
<li>
<a class="dropdown-item" href="../../../gis/technologies/">Technologies</a>
</li>
<li>
<a class="dropdown-item" href="../../../gis/resources/">Resources</a>
</li>
</ul>
</li>
<li class="dropdown">
<a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Development <b class="caret"></b></a>
<ul class="dropdown-menu">
<li>
<a class="dropdown-item" href="../../../development/">Development</a>
</li>
<li>
<a class="dropdown-item" href="../../../development/conventions/">Conventions</a>
</li>
<li>
<a class="dropdown-item" href="../../../development/technologies/">Languages</a>
</li>
<li>
<a class="dropdown-item" href="../../../development/environments/">Environments</a>
</li>
</ul>
</li>
<li class="dropdown">
<a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">DevOps <b class="caret"></b></a>
<ul class="dropdown-menu">
<li>
<a class="dropdown-item" href="../../../devops/">DevOps</a>
</li>
<li>
<a class="dropdown-item" href="../../../devops/security/">Security</a>
</li>
<li>
<a class="dropdown-item" href="../../../devops/procedures/">Procedures</a>
</li>
<li>
<a class="dropdown-item" href="../../../devops/infrastructure/">Infrastructure</a>
</li>
</ul>
</li>
<li class="dropdown">
<a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Resources <b class="caret"></b></a>
<ul class="dropdown-menu">
<li>
<a class="dropdown-item" href="../../">Resources</a>
</li>
<li>
<a class="dropdown-item" href="../">Cheatsheets</a>
</li>
<li>
<a class="dropdown-item" href="../../tutorials/">Tutorials</a>
</li>
<li>
<a class="dropdown-item" href="../../media/">Media</a>
</li>
<li>
<a class="dropdown-item" href="../../links/">Links</a>
</li>
</ul>
</li>
</ul>
<ul class="nav navbar-nav ml-auto">
<li class="nav-item">
<a class="nav-link" href="https://github.com/kartoza/TheKartozaHandbook/blob/main/docs/library/cheatsheets/kubectl.md">Edit on Kartoza Handbook</a>
</li>
</ul>
</div>
</div>
</div>
<div class="container">
<div class="row">
<div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
<div class="navbar-header">
<button class="navbar-toggler collapsed" data-target="#toc-collapse" data-toggle="collapse" title="Table of Contents" type="button">
<span class="fa fa-angle-down"></span>
</button>
</div>
<div class="navbar-collapse collapse card bg-secondary" id="toc-collapse">
<ul class="nav flex-column">
<li class="nav-item" data-level="1"><a class="nav-link" href="#kubectl">Kubectl</a>
<ul class="nav flex-column">
<li class="nav-item" data-level="2"><a class="nav-link" href="#kustomize">Kustomize</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-level="2"><a class="nav-link" href="#helm">Helm</a>
<ul class="nav flex-column">
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div></div>
<div class="col-md-9" role="main">
<h1 id="kubectl">Kubectl</h1>
<blockquote>
<p>This article is under heavy development and is not considered production ready</p>
</blockquote>
<p><a href="https://kubernetes.io/docs/reference/kubectl/kubectl/">Kubectl</a> (Kubernetes Control) is a commandline utility for managing Kubernetes clusters.</p>
<h2 id="kustomize">Kustomize</h2>
<p>Kustomize is a utility for building and "patching" complete resource definitions from a subset of information, allowing .</p>
<p>There are a lot of declarative items within a set of Kubernetes resources that may be consistent and repeating these definitions would become rather redundant. An example would be all the resources in the project requiring the inclusion of the namespace element in the resource metadata.</p>
<p>Not only is this redundancy inefficient to manage and control, but it also violates DRY principles that ensure our components are managed consistently and to prevent errors.</p>
<h3 id="common-operations">Common operations</h3>
<p>To validate the current resource configurations, run <code>kubectl kustomize</code>, or pipe the output to a file with <code>kubectl kustomize &gt; output.yaml</code> to create a single file with a complete set of the resource definitions available within the current directory.</p>
<p>Apply the current directories manifests using kustomize with <code>kubectl apply -k .</code>, with <code>.</code> being the current directory and using a <code>kustomize.yaml</code> file to define the resources to apply.</p>
<p>Use <code>kubectl -n my-namespace get pods</code> to list the pods in the <code>my-namespace</code> namespace.</p>
<p>This is useful when you want to find a pod by name, so that you can execute the command directly against a pod that forms a particular service. You would have to be careful with your deployments naming conventions to avoid collisions, but it can be super handy to enhance your automation capabilities.</p>
<pre><code class="language-bash">$ nginx_pod=$(kubectl -n my-namespace get pods | awk '{print $1}' | grep -m 1 -e "nginx") &amp;&amp; \
echo $nginx_pod
</code></pre>
<p>If you're a sucker for punishment, you can accomplish a similar result with powershell.</p>
<pre><code class="language-powershell">&gt; $nginx_pod = (kubectl -n my-namespace get pods |  Select-String -Pattern "nginx" -SimpleMatch | select -first 1 | %{ ($_ -split "\s+")[0]})
&gt; Write-Output $nginx_pod
</code></pre>
<p>This makes it trivial to copy data into a volume with kubectl</p>
<pre><code class="language-bash">nginx_pod=$(kubectl -n my-namespace get pods | awk '{print $1}' | grep -m 1 -e "nginx") &amp;&amp; \
  kubectl -n my-namespace cp ./configs/web/index.html $nginx_pod:/web/index.html
</code></pre>
<p>Or execute commands such as a mapproxy cleanup</p>
<pre><code class="language-bash">mapproxy_pod=$(kubectl -n my-namespace get pods | awk '{print $1}' | grep -m 1 -e "mapproxy") &amp;&amp; \
  kubectl -n my-namespace exec $mapproxy_pod -- /bin/bash -c "mapproxy-seed -s /mapproxy/seed.yaml -f /mapproxy/mapproxy.yaml -c 4 --cleanup=remove_complete_levels"
</code></pre>
<p>Or run the command in the background within the pod, such as a mapproxy seeding operation</p>
<pre><code class="language-bash">mapproxy_pod=$(kubectl -n my-namespace get pods | awk '{print $1}' | grep -m 1 -e "mapproxy") &amp;&amp; \
  kubectl -n my-namespace exec $mapproxy_pod -- /bin/bash -c "mapproxy-seed -s /mapproxy/seed.yaml -f /mapproxy/mapproxy.yaml -c 4 &gt; /dev/null 2&gt; /dev/null &amp;"
</code></pre>
<h2 id="helm">Helm</h2>
<p>Helm is a Kubernetes Native package manager that provides more complex management capabilities for k8s resources. Helm is a separate application from kubectl that must be installed on a system with access to the cluster via the <code>~/.kube/config</code> file.</p></div>
</div>
</div>
<footer class="col-md-12">
<hr/>
<p>Kartoza and Contributors</p>
<p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
</footer>
<script>
            var base_url = "../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
<script defer="" src="../../../js/base.js"></script>
<div aria-hidden="true" aria-labelledby="keyboardModalLabel" class="modal" id="mkdocs_keyboard_modal" role="dialog" tabindex="-1">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
<button class="close" data-dismiss="modal" type="button"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
</div>
<div class="modal-body">
<table class="table">
<thead>
<tr>
<th style="width: 20%;">Keys</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td class="help shortcut"><kbd>?</kbd></td>
<td>Open this help</td>
</tr>
<tr>
<td class="next shortcut"><kbd>n</kbd></td>
<td>Next page</td>
</tr>
<tr>
<td class="prev shortcut"><kbd>p</kbd></td>
<td>Previous page</td>
</tr>
<tr>
<td class="search shortcut"><kbd>s</kbd></td>
<td>Search</td>
</tr>
</tbody>
</table>
</div>
<div class="modal-footer">
</div>
</div>
</div>
</div>
</body>
</html>
